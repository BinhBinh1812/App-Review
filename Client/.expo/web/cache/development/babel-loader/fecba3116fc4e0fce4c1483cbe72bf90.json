{"ast":null,"code":"import _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useState, useCallback, useEffect, useRef } from \"react\";\nimport { GiftedChat } from \"react-native-gifted-chat\";\nimport { io } from \"socket.io-client\";\nimport { useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport * as axiosMessage from \"../api/axiosMessage\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nexport default function ChatScreen() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      messages = _useState2[0],\n      setMessages = _useState2[1];\n\n  var _useState3 = useState(\"\"),\n      _useState4 = _slicedToArray(_useState3, 2),\n      newMessage = _useState4[0],\n      setNewMessage = _useState4[1];\n\n  var _useState5 = useState(null),\n      _useState6 = _slicedToArray(_useState5, 2),\n      currentChat = _useState6[0],\n      setCurrentChat = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      arrivalMessage = _useState8[0],\n      setArrivalMessage = _useState8[1];\n\n  var _useSelector = useSelector(function (state) {\n    return state.authReducer;\n  }),\n      userId = _useSelector.userId;\n\n  var socket = useRef();\n  useEffect(function () {\n    socket.current = io(\"http://192.168.1.19:9000\");\n    socket.current.emit(\"addUser\", userId);\n    socket.current.on(\"getMessage\", function (data) {\n      console.log(data);\n    });\n  }, [userId]);\n  useEffect(function () {\n    setMessages(function (prev) {\n      return [].concat(_toConsumableArray(prev), [arrivalMessage]);\n    });\n  }, [arrivalMessage]);\n  useEffect(function () {\n    var getMessage = function _callee() {\n      var response, newResponse;\n      return _regeneratorRuntime.async(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return _regeneratorRuntime.awrap(axiosMessage.get(\"62b08e79973052bec87e49f4\"));\n\n            case 3:\n              response = _context.sent;\n              newResponse = response.map(function (item) {\n                return {\n                  _id: item._id,\n                  text: item.text,\n                  createdAt: item.createdAt,\n                  user: {\n                    _id: item.sender == userId ? 1 : 2,\n                    name: \"React Native\",\n                    avatar: \"https://placeimg.com/140/140/any\"\n                  }\n                };\n              });\n              setMessages(newResponse);\n              _context.next = 11;\n              break;\n\n            case 8:\n              _context.prev = 8;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(\"Chat Screen\", _context.t0);\n\n            case 11:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, null, null, [[0, 8]], Promise);\n    };\n\n    getMessage();\n  }, [currentChat]);\n\n  var _onSend = useCallback(function _callee2() {\n    var messages,\n        response,\n        newResponse,\n        _args2 = arguments;\n    return _regeneratorRuntime.async(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            messages = _args2.length > 0 && _args2[0] !== undefined ? _args2[0] : [];\n            socket.current.emit(\"sendMessage\", {\n              senderId: userId,\n              receiverId: \"62ab25fa20c838c7bd92d585\",\n              text: messages[0].text\n            });\n            _context2.prev = 2;\n            _context2.next = 5;\n            return _regeneratorRuntime.awrap(axiosMessage.post(\"/\", {\n              sender: userId,\n              text: messages[0].text,\n              conversationId: \"62b08e79973052bec87e49f4\"\n            }));\n\n          case 5:\n            response = _context2.sent;\n            newResponse = {\n              _id: response._id,\n              text: response.text,\n              createdAt: Date.now(),\n              user: {\n                _id: response.sender == userId ? 1 : 2,\n                name: \"React Native\",\n                avatar: \"https://placeimg.com/140/140/any\"\n              }\n            };\n            messages.push({\n              newResponse: newResponse\n            });\n            _context2.next = 13;\n            break;\n\n          case 10:\n            _context2.prev = 10;\n            _context2.t0 = _context2[\"catch\"](2);\n            console.log(\"On Send\", _context2.t0);\n\n          case 13:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, [[2, 10]], Promise);\n  }, []);\n\n  return _jsx(GiftedChat, {\n    messages: messages.sort(function (a, b) {\n      return Date.parse(b.createdAt) - Date.parse(a.createdAt);\n    }),\n    onSend: function onSend(messages) {\n      return _onSend(messages);\n    },\n    user: {\n      _id: 1\n    }\n  });\n}","map":{"version":3,"names":["React","useState","useCallback","useEffect","useRef","GiftedChat","io","useSelector","axios","axiosMessage","ChatScreen","messages","setMessages","newMessage","setNewMessage","currentChat","setCurrentChat","arrivalMessage","setArrivalMessage","state","authReducer","userId","socket","current","emit","on","data","console","log","prev","getMessage","get","response","newResponse","map","item","_id","text","createdAt","user","sender","name","avatar","onSend","senderId","receiverId","post","conversationId","Date","now","push","sort","a","b","parse"],"sources":["C:/Users/TTB/Desktop/Demo/Test/src/screens/ChatScreen.js"],"sourcesContent":["import React, { useState, useCallback, useEffect, useRef } from \"react\";\nimport { GiftedChat } from \"react-native-gifted-chat\";\nimport { io } from \"socket.io-client\";\nimport { useSelector } from \"react-redux\";\nimport axios from \"axios\";\nimport * as axiosMessage from \"../api/axiosMessage\";\n\nexport default function ChatScreen() {\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState(\"\");\n  const [currentChat, setCurrentChat] = useState(null);\n  const [arrivalMessage, setArrivalMessage] = useState(null);\n  const { userId } = useSelector((state) => state.authReducer);\n  const socket = useRef();\n\n  useEffect(() => {\n    socket.current = io(\"http://192.168.1.19:9000\");\n    socket.current.emit(\"addUser\", userId);\n    socket.current.on(\"getMessage\", (data) => {\n      console.log(data);\n    });\n  }, [userId]);\n\n  useEffect(() => {\n    setMessages((prev) => [...prev, arrivalMessage]);\n  }, [arrivalMessage]);\n\n  useEffect(() => {\n    const getMessage = async () => {\n      try {\n        const response = await axiosMessage.get(\"62b08e79973052bec87e49f4\");\n        let newResponse = response.map((item) => {\n          return {\n            _id: item._id,\n            text: item.text,\n            createdAt: item.createdAt,\n            user: {\n              _id: item.sender == userId ? 1 : 2,\n              name: \"React Native\",\n              avatar: \"https://placeimg.com/140/140/any\",\n            },\n          };\n        });\n        setMessages(newResponse);\n      } catch (error) {\n        console.log(\"Chat Screen\", error);\n      }\n    };\n    getMessage();\n  }, [currentChat]);\n\n  const onSend = useCallback(async (messages = []) => {\n    socket.current.emit(\"sendMessage\", {\n      senderId: userId,\n      receiverId: \"62ab25fa20c838c7bd92d585\",\n      text: messages[0].text,\n    });\n\n    try {\n      const response = await axiosMessage.post(\"/\", {\n        sender: userId,\n        text: messages[0].text,\n        conversationId: \"62b08e79973052bec87e49f4\",\n      });\n      let newResponse = {\n        _id: response._id,\n        text: response.text,\n        createdAt: Date.now(),\n        user: {\n          _id: response.sender == userId ? 1 : 2,\n          name: \"React Native\",\n          avatar: \"https://placeimg.com/140/140/any\",\n        },\n      };\n\n      // console.log(\"////\", newResponse);\n      messages.push({ newResponse });\n    } catch (error) {\n      console.log(\"On Send\", error);\n    }\n  }, []);\n\n  return (\n    <GiftedChat\n      messages={messages.sort(\n        (a, b) => Date.parse(b.createdAt) - Date.parse(a.createdAt)\n      )}\n      onSend={(messages) => onSend(messages)}\n      user={{\n        _id: 1,\n      }}\n    />\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}